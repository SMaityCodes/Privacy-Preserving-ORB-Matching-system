# Privacy-Preserving-ORB-Matching-system

## 📁 Project Structure

```

Privacy-Preserving-ORB-Matching-system/
├── Circom_Circuits/              
│   ├── ORB_Matcher.circom      # The main Circom Circuit implementing ORB Matching
│   └── ORB_Utils.circom        # The Circuit implementing utility templates required by 'ORB_Matcher.circom'
├── Images/              
│   ├── Item1
│   │   └── image1.jpg, image2.jpg, image3.jpg
│   │              # Test images for item1
│   └── Item2
│       └── image1.jpg, image2.jpg, image3.jpg
│                  # Test images for item2
├── Python_Progs/              
│   ├── featureExtracter.py   # extracts ORB descriptors from image and saves into a '.pkl' file.
│   │                            Uses OpenCV (cv2) library.
│   ├── standardMatcher.py    # performs ORB matching using "cv2.BFMatcher"
│   │                            and applying Lowe's ratio test  
│   ├── ORB_Matcher.py        # performs exactly the same task as "standardMatcher.py" however
│   │                           without using python standard libraries. Implements hamming_distance
│   │                           function, KNN matching logic, Lowe's ratio test from the scratch.
│   └── circomPreprocessor.py # Takes feature files in '.pkl' formats, converts them as binary
│                               2-D matrices in JSON format required for the Circom program. 
├── MerkelRootCal/    
│   └── calMerkleRoot.js  # Calculates MerkleRoots of the two feature matrices generated by
│                            "circomPreprocessor.py". For each feature matrix, it generates
│                             two roots - left (taking leftmost 128 bits of each feature vector)
│                             and right (with the rest)
├── tmp/              # Contains the feature files (.pkl) generated by "featureExtracter.py"
├── ORB_Circom.sh             # takes two image files, extracts their features using "featureExtracter.py",
│                               generates "CircomInput.JSON" from the extracted feature files, Calculates
│                               and attaches MerkleRoots using "calMerkleRoot.js" and finally runs the
│                               "ORB_Matcher.circom" Circom Code on "circomInputWithHash.json" to calculate matches
├── ORB_Python.sh             # takes two image files, extracts their features using the "featureExtracter.py"
│                               program and then runs the "ORB_Matcher.py" Python Code on the two extracted
│                               feature files to calculate matches
├── TestScript.sh             # executes the "ORB_Matcher.py" Python Code for every pair of iamges from
│                                1) same Item and 2) from different items.  
└── params.dat             # Contains all the configuration parameters from whcih "standardMatcher.py",
                             "ORB_Matcher.py" and "circomPreprocessor.py" reads the values and configures
                             the python and circom matcher codes with exactly the same configurations.

```


TESTING THE PYTHON PROGRAMS:-


# Grant Exeuton Priviledge to the bash scripts:-
chmod +x ORB_Python.sh
chmod +x TestScript.sh
chmod +x ORB_Circom.sh


# Eextract feature files from any two image files using the "featureExtracter.py" program. First argument is input filename, second argument is output filename and the third argument is no. of features to be extracted.

python3 ./Python_Progs/featureExtracter.py -i ./Images/Item1/image1.jpg -o ./tmp/Features1.pkl -n 100
python3 ./Python_Progs/featureExtracter.py -i ./Images/Item1/image2.jpg -o ./tmp/Features2.pkl -n 100

# Run the ORB_Matcher Python Code on the two extracted feature files:-

python3 ./Python_Progs/ORB_Matcher.py ./tmp/Features1.pkl ./tmp/Features2.pkl 100 100

# Cross-check the correctness of "ORB_Matcher.py" using the "standardMatcher.py" by matching the output of the two programs on the same feature files:-

python3 ./Python_Progs/standardMatcher.py -pkl1 ./tmp/Features1.pkl -pkl2 ./tmp/Features2.pkl


# The following script takes two image files, extracts their features using the "featureExtracter.py" program and then runs the "ORB_Matcher" Python Code on the two extracted feature files to calculate matches:-

./ORB_Python.sh 100 ./Images/Item1/image1.jpg ./Images/Item1/image2.jpg

# The following script executes the "ORB_Matcher" Python Code for every pair of iamges from 1) same Item and 2) from different items.  The script internally calls the "ORB_Python.sh" script in iteraton. Before running the following script, set the debug flag to zero in "ORB_Python.sh" (for ease of visualiztion only).

./TestScript.sh 
=============================================================================================================

# Eextract feature files from any two image files of your choice using the "featureExtracter.py" program.

python3 ./Python_Progs/featureExtracter.py -i ./Images/Item1/image1.jpg -o ./tmp/Features1.pkl -n 100
python3 ./Python_Progs/featureExtracter.py -i ./Images/Item1/image2.jpg -o ./tmp/Features2.pkl -n 100

# Run "circomPreprocessor.py" to generate "CircomInput.JSON" from the extracted feature files. 

python3 ./Python_Progs/circomPreprocessor.py ./tmp/Features1.pkl ./tmp/Features2.pkl 100 100

# cd inside the "Circom_Circuits" dir and Compile the main Circom_Circuit using the following command:-

circom ORB_Matcher.circom --r1cs --wasm --sym -l /home/smaity/

# To attach Merkle Roots:-

node ./MerkelRootCal/calMerkleRoot.js 

# To generate Witness run the following command:-

node ./Circom_Circuits/ORB_Matcher_js/generate_witness.js ./Circom_Circuits/ORB_Matcher_js/ORB_Matcher.wasm circomInputWithHash.json witness.wtns


# The following script takes two image files, extracts their features using the "featureExtracter.py" program, generates "CircomInput.JSON" from the extracted feature files, and then runs the "ORB_Matcher" Circom Code on the two extracted feature files to calculate matches:-

./ORB_Circom.sh 100 ./Images/Item1/image1.jpg ./Images/Item1/image2.jpg


=======================================================
Now you can compare the result produced by the Python program and the resul produced by the Circom program on any two images of your choice by just comparing the outcome of folloiwng two scripts:-

./ORB_Python.sh 100 ./Images/Item1/image1.jpg ./Images/Item1/image2.jpg

VS.

./ORB_Circom.sh 100 ./Images/Item1/image1.jpg ./Images/Item1/image2.jpg

